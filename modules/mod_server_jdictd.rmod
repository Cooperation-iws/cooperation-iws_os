#!/bin/bash


RMOD_ENGINE=1.0
RMOD_CATEGORY='Software'
RMOD_SUBCATEGORY='Servers'
RMOD_NAME='Jdicd1.5'
RMOD_AUTHOR='Oliv'
RMOD_VERSION=0.2
RMOD_DESCRIPTION='Translations Dictionnary'
RMOD_RUN_IN_CHROOT=True
RMOD_UPDATE_URL='http://cooperation-iws.gensys-net.eu/update/modules/'


WWW_DIRECTORY=$(cat /tmp/web-path)
DL_DIR=$(cat /tmp/web_install-path)
BIN_MYSQL=$(cat /tmp/mysql-path)
SCRIPT_DIRECTORY=$(cat /tmp/script-path)
DISPLAY=127.0.0.1:5.0
LAMPP_DIRECTORY=$(cat /tmp/lampp-dir)
LANG_UI=$(cat /tmp/lang-wui)


#TEMP
MIRROIR=$(cat /tmp/mirroir)
URL_FREE=$(cat /tmp/url_mirroir)

INSTALL=$(cat /tmp/def_install)
MOD_NAME="Dictionnary"


#VARIABLES

#_______________________________________________________________________________________________
#________________________________________WGET_MIRROIR_WEB_______________________________________


function WGET_MIRROIR_WEB
{

cd $DL_DIR
wget http://www.informatik.uni-leipzig.de/~duc/Java/JDictd/jdictd15.zip
unzip jdictd15.zip


mkdir jdictd15/DOC

wget ftp://ftp.dict.org/pub/dict/pre/www.freedict.de/20050319/fra-eng.tar.gz
tar -xzf fra-eng.tar.gz -C jdictd15/DOC
echo "
fra-eng.data=fra-eng.dict.dz
fra-eng.index=fra-eng.index
" >> jdictd15/DOC/fra-eng.ini

wget ftp://ftp.dict.org/pub/dict/pre/www.freedict.de/20050319/fra-deu.tar.gz
tar -xzf fra-deu.tar.gz -C jdictd15/DOC
echo "
fra-deu.data=fra-deu.dict.dz
fra-deu.index=fra-deu.index
" >> jdictd15/DOC/fra-deu.ini

wget ftp://ftp.dict.org/pub/dict/pre/www.freedict.de/20050319/eng-fra.tar.gz
tar -xzf eng-fra.tar.gz -C jdictd15/DOC
echo "
eng-fra.data=eng-fra.dict.dz
eng-fra.index=eng-fra.index
" >> jdictd15/DOC/eng-fra.ini

wget ftp://ftp.dict.org/pub/dict/pre/www.freedict.de/20050319/deu-fra.tar.gz
tar -xzf deu-fra.tar.gz -C jdictd15/DOC
echo "
deu-fra.data=deu-fra.dict.dz
deu-fra.index=deu-fra.index
" >> jdictd15/DOC/deu-fra.ini

wget ftp://ftp.dict.org/pub/dict/pre/www.freedict.de/20050319/eng-spa.tar.gz
tar -xzf eng-spa.tar.gz -C jdictd15/DOC
echo "
eng-spa.data=eng-spa.dict.dz
eng-spa.index=eng-spa.index
" >> jdictd15/DOC/eng-spa.ini

}

#_______________________________________________________________________________________________
#________________________________________FIN_WGET_MIRROIR_WEB___________________________________


#_______________________________________________________________________________________________
#________________________________________WGET_MIRROIR_FREE______________________________________

function WGET_MIRROIR_FREE
{
cd $DL_DIR
wget $URL_FREE/jdictd15.zip
unzip jdictd15.zip


mkdir jdictd15/DOC

wget $URL_FREE/fra-eng.tar.gz
tar -xzf fra-eng.tar.gz -C jdictd15/DOC
echo "
fra-eng.data=fra-eng.dict.dz
fra-eng.index=fra-eng.index
" >> jdictd15/DOC/fra-eng.ini

wget $URL_FREE/fra-deu.tar.gz
tar -xzf fra-deu.tar.gz -C jdictd15/DOC
echo "
fra-deu.data=fra-deu.dict.dz
fra-deu.index=fra-deu.index
" >> jdictd15/DOC/fra-deu.ini

wget $URL_FREE/eng-fra.tar.gz
tar -xzf eng-fra.tar.gz -C jdictd15/DOC
echo "
eng-fra.data=eng-fra.dict.dz
eng-fra.index=eng-fra.index
" >> jdictd15/DOC/eng-fra.ini

wget $URL_FREE/deu-fra.tar.gz
tar -xzf deu-fra.tar.gz -C jdictd15/DOC
echo "
deu-fra.data=deu-fra.dict.dz
deu-fra.index=deu-fra.index
" >> jdictd15/DOC/deu-fra.ini

wget $URL_FREE/eng-spa.tar.gz
tar -xzf eng-spa.tar.gz -C jdictd15/DOC
echo "
eng-spa.data=eng-spa.dict.dz
eng-spa.index=eng-spa.index
" >> jdictd15/DOC/eng-spa.ini

}

#_______________________________________________________________________________________________
#________________________________________FIN_WGET_MIRROIR_FREE__________________________________

#_______________________________________________________________________________________________
#________________________________________DOWNLOAD_______________________________________________

function DOWNLOAD
{
if [ "$(echo "${MIRROIR}" | awk  '{print $1}')" == "A" ]; then 

WGET_MIRROIR_WEB
fi
if  [ "$(echo "${MIRROIR}" | awk  '{print $1}')" == "B" ]; then

WGET_MIRROIR_FREE
fi

}


#_______________________________________________________________________________________________
#________________________________________FIN_DOWNLOAD___________________________________________



#_______________________________________________________________________________________________
#________________________________________INSTALL________________________________________________


function INSTALL
{
DOWNLOAD


ln -s / /cow
apt-get install --assume-yes --force-yes sun-java5-bin sun-java5-jre
mkdir $WWW_DIRECTORY/$MOD_NAME/
cp -r jdictd15/* $WWW_DIRECTORY/$MOD_NAME/.

nohup java -cp $WWW_DIRECTORY/$MOD_NAME/jdictd.jar org.dict.server.JDictd Elements/elements.ini DOC/eng-spa.ini DOC/deu-fra.ini DOC/eng-fra.ini DOC/fra-deu.index DOC/fra-eng.ini &



echo "
#Jdict

nohup java -cp $WWW_DIRECTORY/$MOD_NAME/jdictd.jar org.dict.server.JDictd Elements/elements.ini DOC/eng-spa.ini DOC/deu-fra.ini DOC/eng-fra.ini DOC/fra-deu.index DOC/fra-eng.ini &
" >> /etc/rc.local

}

#_______________________________________________________________________________________________
#________________________________________FIN_INSTALL____________________________________________

#_______________________________________________________________________________________________
#________________________________________CREATE_WUI_____________________________________________

function CREATE_WUI
{

echo "
<item>
<item_category>$RMOD_DESCRIPTION</item_category>
<item_url>http://<?php echo \$HTTP_SERVER_VARS[\"SERVER_NAME\"]?>:2626</item_url>
<item_name>$RMOD_NAME</item_name>
<item_desc>$RMOD_VERBOSE</item_desc>
</item>
" >> $WWW_DIRECTORY/cooperation-wui.xml
}

#_______________________________________________________________________________________________
#________________________________________FIN_CREATE_WUI_________________________________________




echo "I: Install Ntop"
INSTALL
CREATE_WUI
echo "I: End of install Ntop"
