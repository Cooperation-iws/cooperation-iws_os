#!/bin/sh

RMOD_ENGINE=1.0
RMOD_CATEGORY='Software'
RMOD_SUBCATEGORY='Client'
RMOD_NAME='update live-initramfs'
RMOD_AUTHOR='Oliv'
RMOD_VERSION=0.2
RMOD_DESCRIPTION='Office tools for client'
RMOD_RUN_IN_CHROOT=True
RMOD_UPDATE_URL='http://cooperation-iws.gensys-net.eu/update/modules/'
URL_FREE=$(cat /tmp/url_mirroir)

echo "I: updating live-initramfs to live-initramfs from dev"

apt-get remove --assume-yes --force-yes live-initramfs

cd /tmp

wget $URL_FREE/live-initramfs_1.154.8+20090130.001702_all.deb
dpkg -i live-initramfs_1.154.8+20090130.001702_all.deb
apt-get install -f --assume-yes --force-yes 

chmod 755 /usr/share/live-initramfs/languagelist

#sed -i "23G" /usr/share/initramfs-tools/scripts/live
#sed -i '23s/^/cat \/proc\/cmdline > \/cmdline/'  /usr/share/initramfs-tools/scripts/live
#sed -i '24s/^/sed -i "s\/bootkbd\/keyb\/" \/cmdline/'  /usr/share/initramfs-tools/scripts/live
#sed -i '50s/\/proc//' /usr/share/initramfs-tools/scripts/live

sed -i '31s/^/cp \/usr\/share\/keymaps\/i386\/azerty\/fr.kmap.gz ${DESTDIR}\/etc\//' /usr/share/initramfs-tools/hooks/keymap
sed -i '175G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '175G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '175G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '175G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '175G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '175G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '176s/^/if [ "$KBD" = "fr" ];then/' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '177s/^/if [ -x \/bin\/loadkeys -a -r \/etc\/fr.kmap.gz ]/' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '178s/^/then/' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '179s/^/loadkeys \/etc\/fr.kmap.gz/' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '180s/^/fi/' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '181s/^/else/' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '185G' /usr/share/initramfs-tools/scripts/live-helpers
sed -i '186s/^/fi/' /usr/share/initramfs-tools/scripts/live-helpers

